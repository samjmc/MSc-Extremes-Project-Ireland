---
title: "BM vs POT"
author: "Samuel McDonnell"
date: "2024-06-25"
output: html_document
---

```{r}
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(tmap)
library(sf)

# Load spatial data for Ireland
ireland <- st_read("IRL_adm0.shp")

# Example location data with longitude and latitude
data_unique <- distinct(data, station_name, lon, lat)

# Join BM and POT dataframes with location data
bm_data <- inner_join(return_levels_all_block, data_unique, by = "station_name")
pot_data <- inner_join(return_levels_all, data_unique, by = "station_name")

# Join the BM and POT dataframes by station_name to compare
comparison_data <- bm_data %>%
  select(station_name, lon, lat, return_5yr_block = return_5yr) %>%
  inner_join(pot_data %>% select(station_name, return_5yr_pot = return_5yr), by = "station_name")

# Calculate the actual differences between BM and POT return levels
comparison_data <- comparison_data %>%
  mutate(difference = return_5yr_block - return_5yr_pot)

# Convert to sf object
comparison_sf <- st_as_sf(comparison_data, coords = c("lon", "lat"), crs = 4326)

# Plot the actual differences on a map with a continuous color scale
tm_shape(ireland) +
  tm_borders() +
  tm_shape(comparison_sf) +
  tm_dots(col = "difference", palette = "-RdYlBu", 
          title = "Difference in 5-Year Return Levels (BM - POT)", size = 1, alpha = 0.9) +
  tm_style("white")

```

